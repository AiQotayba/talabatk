### Delivery App API - Comprehensive Documentation & Tests
### Base URL: http://localhost:4000
### Documentation: http://localhost:4000/api/docs
### ====================================================== 
 

GET http://localhost:4000/api/orders
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyYjM2OWE3Ni02ZmU2LTQ0OWQtYjYyNy04MGE5ZDA2ZmI2NjYiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjcyODg4NDksImV4cCI6MTc2NzI5MjQ0OX0.WJzFVkEF7YF2UXZcCwlYMaSHLzf79Yw7ewjcfmQYDsE


POST http://localhost:4000/api/messages
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyYjM2OWE3Ni02ZmU2LTQ0OWQtYjYyNy04MGE5ZDA2ZmI2NjYiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjcyODg4NDksImV4cCI6MTc2NzI5MjQ0OX0.WJzFVkEF7YF2UXZcCwlYMaSHLzf79Yw7ewjcfmQYDsE 
Content-Type: application/json

{
  "order_id": "7be15646-9910-4e50-b51d-9a36141e24fc",
  "content": "Are you on your way?",
  "message_type": "text"
}





POST {{apiUrl}}/auth/login
Content-Type: application/json
{
  "email": "ktsyr1@gmail.com",
  "password": "password123"
}
POST {{apiUrl}}/auth/login
Content-Type: application/json
{
  "email": "driver@app.com",
  "password": "password123"
}
POST {{apiUrl}}/auth/login
Content-Type: application/json
{
  "email": "admin@app.com",
  "password": "password123"
}

## ============================================
### 5. Order Management Endpoints 

@apiUrl = http://localhost:4000/api
# @clientToken
@driverToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiMmE5ZGI3Ny0xOWQ2LTQxNmQtYTI1OC01NGJhYWI0NDZjMTIiLCJyb2xlIjoiY2xpZW50IiwiaWF0IjoxNzYyODgwNTEyLCJleHAiOjE3NjI4ODQxMTJ9.iSJmhADp7uOwZ5BzDE_iWxvgPK2RsMsuK-aeET4vUuY
@addressId=355c3013-b510-4827-9194-2fe3ad73c0a1
@orderId=d2634bec-9997-4a70-b33d-78a86cc0d4b3

# GET {{apiUrl}}/orders/driver/pending
# Authorization: {{driverToken}}
# Content-Type: application/json

GET {{apiUrl}}/orders 
Authorization: {{driverToken}}
Content-Type: application/json

POST {{apiUrl}}/orders/{{orderId}}/accept
Authorization: {{driverToken}}
Content-Type: application/json

POST {{apiUrl}}/orders/{{orderId}}/reject
Authorization: {{driverToken}}
Content-Type: application/json


###
### ============================================
### 6. Location & Tracking Endpoints
### ============================================

@apiUrl = http://localhost:4000/api
@clientToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiMmE5ZGI3Ny0xOWQ2LTQxNmQtYTI1OC01NGJhYWI0NDZjMTIiLCJyb2xlIjoiY2xpZW50IiwiaWF0IjoxNzYyODY3NDAxLCJleHAiOjE3NjI4NzEwMDF9.RVlPfX23BKuHcePtG5n081L29jS11PNDSPWQcHvhAgI
@driverToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5NGY1OWQ5OC1kYjIyLTQ4YzItOTVlYS03OTEyMmNlNjQzMTMiLCJyb2xlIjoiZHJpdmVyIiwiaWF0IjoxNzYyODY3MTY5LCJleHAiOjE3NjI4NzA3Njl9.JK0-0xGt8kxi5rYPQ_RiVvCI5QoMmfoEIKVvERYzZ7M
@adminToken = Bearer YOUR_ADMIN_TOKEN_HERE
@orderId=d2634bec-9997-4a70-b33d-78a86cc0d4b3
# GET {{apiUrl}}/location/order/{{orderId}}
# Authorization: {{clientToken}}
# Content-Type: application/json

POST {{apiUrl}}/messages
Authorization: {{clientToken}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "content": "Hello, where are you now?",
  "message_type": "text"
}

### Send Message to User (Direct Message)
POST {{apiUrl}}/messages
Authorization: {{clientToken}}
Content-Type: application/json

{
  "to_user": "{{driverId}}",
  "content": "Thanks for the delivery!",
  "message_type": "text"
}

### Send Audio Message
POST {{apiUrl}}/messages
Authorization: {{clientToken}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "content": "Voice message recording",
  "message_type": "audio",
  "attachments": ["https://example.com/audio.mp3"]
}

### Get Order Messages
GET {{apiUrl}}/messages/order/{{orderId}}
Authorization: {{clientToken}}
Content-Type: application/json

### Mark Message as Read
PUT {{apiUrl}}/messages/{{messageId}}/read
Authorization: {{clientToken}}
Content-Type: application/json

###
### ============================================
### 8. Ratings Endpoints
### ============================================

### Create Rating (Client Only)
POST {{apiUrl}}/ratings
Authorization: {{clientToken}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "driver_id": "{{driverId}}",
  "score": 5,
  "comment": "Excellent service! Very professional driver."
}

### Get Driver Ratings
GET {{apiUrl}}/ratings/driver/{{driverId}}
Authorization: {{clientToken}}
Content-Type: application/json

###
### ============================================
### 9. Complaints Endpoints
### ============================================

### Create Complaint (Client Only)
# @name createComplaint
POST {{apiUrl}}/complaints
Authorization: {{clientToken}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "description": "The driver was late and the delivery was damaged",
  "photo_urls": [
    "https://example.com/complaint1.jpg",
    "https://example.com/complaint2.jpg"
  ]
}

### Get Complaint Details
GET {{apiUrl}}/complaints/{{complaintId}}
Authorization: {{clientToken}}
Content-Type: application/json

###
### ============================================
### 10. Admin Endpoints
### ============================================

### Get All Orders (Admin Only)
GET {{apiUrl}}/admin/orders?page=1&limit=20&status=pending
Authorization: {{adminToken}}
Content-Type: application/json

### Get All Orders with Filters
GET {{apiUrl}}/admin/orders?status=delivered&date_from=2024-01-01&date_to=2024-12-31&client_id={{clientId}}
Authorization: {{adminToken}}
Content-Type: application/json

### Get All Drivers (Admin Only)
GET {{apiUrl}}/admin/drivers?page=1&limit=20&status=available
Authorization: {{adminToken}}
Content-Type: application/json

### Update Driver Status (Admin Only)
PUT {{apiUrl}}/admin/drivers/{{driverId}}
Authorization: {{adminToken}}
Content-Type: application/json

{
  "status": "suspended",
  "notes": "Driver violated company policy"
}

### Get Analytics (Admin Only)
GET {{apiUrl}}/admin/analytics?period=monthly
Authorization: {{adminToken}}
Content-Type: application/json

### Get All Complaints (Admin Only)
GET {{apiUrl}}/admin/complaints?page=1&limit=20&status=pending
Authorization: {{adminToken}}
Content-Type: application/json

###
### ============================================
### 11. Complete Workflow Tests
### ============================================

###
### Test Scenario 1: Complete Order Flow
###

### Step 1: Register Client
# @name testRegisterClient
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "name": "Test Client",
  "email": "testclient@example.com",
  "phone": "+201000000001",
  "password": "test123",
  "role": "client"
}

### Step 2: Register Driver
# @name testRegisterDriver
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "name": "Test Driver",
  "email": "testdriver@example.com",
  "phone": "+201000000002",
  "password": "test123",
  "role": "driver"
}

### Step 3: Client Login
# @name testClientLogin
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "email": "testclient@example.com",
  "password": "test123"
}

### Step 4: Driver Login
# @name testDriverLogin
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "email": "testdriver@example.com",
  "password": "test123"
}

### Step 5: Create Address (as Client)
POST {{apiUrl}}/users/addresses
Authorization: Bearer {{testClientLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "city": "Cairo",
  "street": "123 Test Street",
  "label": "Home",
  "lat": 30.0444,
  "lng": 31.2357,
  "is_default": true
}

### Step 6: Create Order (as Client)
POST {{apiUrl}}/orders
Authorization: Bearer {{testClientLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "content": "Test delivery order",
  "dropoff_address_id": "{{addressId}}",
  "payment_method": "cash"
}

### Step 7: Driver Updates Location
PUT {{apiUrl}}/location/driver
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "lat": 30.0444,
  "lng": 31.2357,
  "status": "available"
}

### Step 8: Driver Gets Pending Orders
GET {{apiUrl}}/orders/driver/pending
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}

### Step 9: Driver Accepts Order
POST {{apiUrl}}/orders/{{orderId}}/accept
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}

### Step 10: Driver Updates Order Status
PUT {{apiUrl}}/orders/{{orderId}}/status
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "status": "picked_up"
}

### Step 11: Client Sends Message
POST {{apiUrl}}/messages
Authorization: Bearer {{testClientLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "content": "Are you on your way?",
  "message_type": "text"
}

### Step 12: Driver Updates Status to In Transit
PUT {{apiUrl}}/orders/{{orderId}}/status
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "status": "in_transit"
}

### Step 13: Driver Marks Order as Delivered
PUT {{apiUrl}}/orders/{{orderId}}/status
Authorization: Bearer {{testDriverLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "status": "delivered"
}

### Step 14: Client Rates Driver
POST {{apiUrl}}/ratings
Authorization: Bearer {{testClientLogin.response.body.$.access_token}}
Content-Type: application/json

{
  "order_id": "{{orderId}}",
  "driver_id": "{{driverId}}",
  "score": 5,
  "comment": "Great service!"
}

###
### Test Scenario 2: Error Cases
###

### Test: Register with Existing Email (Should Fail)
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "name": "Duplicate User",
  "email": "testclient@example.com",
  "phone": "+201000000003",
  "password": "test123",
  "role": "client"
}

### Test: Login with Wrong Password (Should Fail)
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "email": "testclient@example.com",
  "password": "wrongpassword"
}

### Test: Create Order Without Address (Should Fail)
POST {{apiUrl}}/orders
Authorization: {{clientToken}}
Content-Type: application/json

{
  "content": "Test order",
  "dropoff_address_id": "invalid-uuid",
  "payment_method": "cash"
}

### Test: Access Protected Route Without Token (Should Fail)
GET {{apiUrl}}/users/profile
Content-Type: application/json

### Test: Client Trying to Access Driver Route (Should Fail)
GET {{apiUrl}}/orders/driver/pending
Authorization: {{clientToken}}
Content-Type: application/json

###
### ============================================
### 12. Pagination Examples
### ============================================

@apiUrl = http://localhost:4000/api
@clientToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiMmE5ZGI3Ny0xOWQ2LTQxNmQtYTI1OC01NGJhYWI0NDZjMTIiLCJyb2xlIjoiY2xpZW50IiwiaWF0IjoxNzYyODc5OTE0LCJleHAiOjE3NjI4ODM1MTR9.-gXE6MLw7bbmhAcI1jE4xChN85W2v_bdMarHC2o9gjc
@driverToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5NGY1OWQ5OC1kYjIyLTQ4YzItOTVlYS03OTEyMmNlNjQzMTMiLCJyb2xlIjoiZHJpdmVyIiwiaWF0IjoxNzYyODY3MTY5LCJleHAiOjE3NjI4NzA3Njl9.JK0-0xGt8kxi5rYPQ_RiVvCI5QoMmfoEIKVvERYzZ7M
@adminToken = Bearer YOUR_ADMIN_TOKEN_HERE
@orderId=d2634bec-9997-4a70-b33d-78a86cc0d4b3    
GET {{apiUrl}}/admin/orders?page=1&limit=50
Authorization: {{adminToken}}

# All {{750}} - {{494}}


 
POST http://localhost:4000/api/storage/images 
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
 
Content-Disposition: form-data; name="images"; filename="proof2.jpg"
Content-Type: image/jpeg

< ./uploads/image.jpeg
------WebKitFormBoundary7MA4YWxkTrZu0gW--